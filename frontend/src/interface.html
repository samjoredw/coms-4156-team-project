<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drug Interaction API Frontend</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            color: #333;
        }

        section {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        input,
        button {
            padding: 10px;
            margin: 5px;
        }

        pre {
            background-color: #f9f9f9;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>
    <h1>Drug Interaction API Frontend</h1>

    <!-- Get All Drugs -->
    <section>
        <h2>1. Get All Drugs</h2>
        <button onclick="getAllDrugs()">Fetch All Drugs</button>
    </section>

    <!-- Get All Drug Interactions -->
    <section>
        <h2>2. Get All Drug Interactions</h2>
        <input id="drugName" type="text" placeholder="Enter Drug Name">
        <button onclick="getAllDrugInteractions()">Fetch All Drug Interactions</button>
    </section>

    <!-- Get Drug Info -->
    <section>
        <h2>3. Get Drug Info</h2>
        <input id="drugName2" type="text" placeholder="Enter Drug Name">
        <button onclick="getDrugInfo()">Get Drug Info</button>
    </section>


    <!-- Add New Drug -->
    <section>
        <h2>4. Add New Drug</h2>
        <input id="newDrugName" type="text" placeholder="Drug Name">
        <input id="newDrugDosageForm" type="text" placeholder="Dosage Form">
        <input id="newDrugIndications" type="text" placeholder="Indications">
        <input id="newDrugContraindications" type="text" placeholder="Contraindications">
        <button onclick="addNewDrug()">Add Drug</button>
    </section>

    <!-- Update Existing Drug -->
    <section>
        <h2>5. Update Existing Drug</h2>
        <input id="updateDrugName" type="text" placeholder="Drug Name (Required)">
        <input id="updateDrugDosageForm" type="text" placeholder="Updated Dosage Form">
        <input id="updateDrugIndications" type="text" placeholder="Updated Indications">
        <input id="updateDrugContraindications" type="text" placeholder="Updated Contraindications">
        <button onclick="updateExistingDrug()">Update Drug</button>
    </section>


    <!-- Delete Drug -->
    <section>
        <h2>6. Delete Drug</h2>
        <input id="deleteDrugName" type="text" placeholder="Enter Drug Name">
        <button onclick="deleteDrug()">Delete Drug</button>
    </section>

    <!-- Check Drug Interactions -->
    <section>
        <h2>7. Check Drug Interactions (Two Drugs)</h2>
        <input id="interactionDrugA" type="text" placeholder="Enter Drug A">
        <input id="interactionDrugB" type="text" placeholder="Enter Drug B">
        <button onclick="checkInteractions()">Check Interactions</button>
    </section>

    <!-- Check Drug Interactions -->
    <section>
        <h2>8. Check Drug Interactions (Up to Five Drugs)</h2>
        <input id="interactionMultiDrugA" type="text" placeholder="Enter Drug A">
        <input id="interactionMultiDrugB" type="text" placeholder="Enter Drug B">
        <input id="interactionMultiDrugC" type="text" placeholder="Enter Drug C">
        <input id="interactionMultiDrugD" type="text" placeholder="Enter Drug D">
        <input id="interactionMultiDrugE" type="text" placeholder="Enter Drug E">
        <button onclick="checkMultipleInteractions()">Check Multiple Interactions</button>
    </section>

    <!-- Add New Drug Interactions -->
    <section>
        <h2>9. Add Drug Interactions</h2>
        <input id="addInteractionDrugA" type="text" placeholder="Enter Drug A">
        <input id="addInteractionDrugB" type="text" placeholder="Enter Drug B">
        <input id="addInteractionEffect" type="text" placeholder="Enter Interaction Effect">
        <button onclick="addDrugInteraction()">Add Drug Interaction</button>
    </section>

    <!-- Delete Existing Drug Interactions -->
    <section>
        <h2>10. Delete Existing Drug Interactions</h2>
        <input id="deleteInteractionDrugA" type="text" placeholder="Enter Drug A">
        <input id="deleteInteractionDrugB" type="text" placeholder="Enter Drug B">
        <input id="deleteInteractionEffect" type="text" placeholder="Enter Interaction Effect">
        <button onclick="deleteDrugInteraction()">Delete Drug Interaction</button>
    </section>


    <!-- Update Existing Drug Interactions -->
    <section>
        <h2>11. Update Existing Drug Interactions</h2>
        <input id="updateInteractionId" type="text" placeholder="Enter Interaction ID">
        <input id="updateInteractionDrugA" type="text" placeholder="Enter Updated Drug A Name">
        <input id="updateInteractionDrugB" type="text" placeholder="Enter Updated Drug B Name">
        <input id="updateInteractionEffect" type="text" placeholder="Enter Updated Interaction Effect">
        <button onclick="updateDrugInteraction()">Update Drug Interaction</button>
    </section>


    <!-- Response Display -->
    <section>
        <h2>Response</h2>
        <pre id="response">No response yet</pre>
    </section>

    <script>
        const baseUrl = 'https://drug-interaction-api.uk.r.appspot.com/api/v1';
        const responseElement = document.getElementById('response');

        function updateResponse(data) {
            if (typeof data === 'string') {
                responseElement.textContent = data;
            } else {
                responseElement.textContent = JSON.stringify(data, null, 2);
            }
        }

        function handleError(error) {
            responseElement.textContent = `Error: ${error.message || error}`;
        }

        async function handleFetch(url, options = {}) {
            try {
                const token = localStorage.getItem('userToken');
                console.log(token);

                // Ensure headers exist and add Authorization token
                options.headers = {
                    ...(options.headers || {}),
                    Authorization: `Bearer ${token}`, // Add the token
                };

                const res = await fetch(url, options);
                const text = await res.text();
                try {
                    const data = JSON.parse(text);
                    updateResponse(data);
                } catch (jsonError) {
                    // Response is not JSON, display raw text
                    updateResponse(text);
                }
            } catch (error) {
                handleError(error);
            }
        }

        // Fetch All Drugs
        async function getAllDrugs() {
            console.log("Fetching all drugs...");
            await handleFetch(`${baseUrl}/drugs`);
        }

        // Fetch All Drug Interactions
        async function getAllDrugInteractions() {
            const drugName = document.getElementById('drugName').value;
            if (!drugName) return alert('Please enter a drug name.');
            await handleFetch(`${baseUrl}/drugs/interactions?drugName=${encodeURIComponent(drugName)}`);
        }

        // Get Drug Info
        async function getDrugInfo() {
            const drugName2 = document.getElementById('drugName2').value;
            if (!drugName2) return alert('Please enter a drug name.');
            await handleFetch(`${baseUrl}/drug?name=${encodeURIComponent(drugName2)}`);
        }

        // Add New Drug
        async function addNewDrug() {
            const name = document.getElementById('newDrugName').value;
            const dosageForm = document.getElementById('newDrugDosageForm').value;
            const indications = document.getElementById('newDrugIndications').value;
            const contraindications = document.getElementById('newDrugContraindications').value;

            if (!name || !dosageForm) return alert('Please fill out all required fields.');

            const payload = {
                "name": name,
                "dosageForm": dosageForm,
                "indications": indications,
                "contraindications": contraindications,
                "createdBy": "admin",
                "updatedBy": "admin",
                "createdAt": new Date().toISOString(),
                "updatedAt": new Date().toISOString(),
            };

            await handleFetch(`${baseUrl}/drug/add`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            });
        }

        // Update Existing Drug
        async function updateExistingDrug() {
            const drugName = document.getElementById('updateDrugName').value;
            const dosageForm = document.getElementById('updateDrugDosageForm').value || "";
            const indications = document.getElementById('updateDrugIndications').value || "";
            const contraindications = document.getElementById('updateDrugContraindications').value || "";

            if (!drugName) {
                alert('Please provide the drug name to update.');
                return;
            }

            const payload = {
                ...(dosageForm && { dosageForm }),
                ...(indications && { indications }),
                ...(contraindications && { contraindications }),
            };

            try {
                await handleFetch(`${baseUrl}/drug/update/${encodeURIComponent(drugName)}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });
            } catch (error) {
                handleError(error);
            }
        }


        // Delete Drug
        async function deleteDrug() {
            const drugName = document.getElementById('deleteDrugName').value;
            if (!drugName) return alert('Please enter a drug name.');
            await handleFetch(`${baseUrl}/drug/remove?name=${encodeURIComponent(drugName)}`, {
                method: 'DELETE',
            });
        }

        // Check Drug Interactions
        async function checkInteractions() {
            const drugA = document.getElementById('interactionDrugA').value;
            const drugB = document.getElementById('interactionDrugB').value;
            if (!drugA || !drugB) return alert('Please enter both drug names.');
            await handleFetch(`${baseUrl}/interactions?drugA=${encodeURIComponent(drugA)}&drugB=${encodeURIComponent(drugB)}`);
        }


        // Check Multiple Drug Interactions
        async function checkMultipleInteractions() {
            const drugA = document.getElementById('interactionMultiDrugA').value;
            const drugB = document.getElementById('interactionMultiDrugB').value;
            const drugC = document.getElementById('interactionMultiDrugC').value;
            const drugD = document.getElementById('interactionMultiDrugD').value;
            const drugE = document.getElementById('interactionMultiDrugE').value;

            if (!drugA || !drugB) {
                alert('Please enter at least two drug names.');
                return;
            }

            // Construct query string dynamically based on provided inputs
            const params = new URLSearchParams();
            if (drugA) params.append('drugA', drugA);
            if (drugB) params.append('drugB', drugB);
            if (drugC) params.append('drugC', drugC);
            if (drugD) params.append('drugD', drugD);
            if (drugE) params.append('drugE', drugE);

            // Fetch interactions
            try {
                await handleFetch(`${baseUrl}/get_interactions?${params.toString()}`);
            } catch (error) {
                handleError(error);
            }
        }

        // Add New Drug Interaction
        async function addDrugInteraction() {
            const drugA = document.getElementById('addInteractionDrugA').value;
            const drugB = document.getElementById('addInteractionDrugB').value;
            const interactionEffect = document.getElementById('addInteractionEffect').value;

            if (!drugA || !drugB || !interactionEffect) return alert('Please fill out all required fields.');

            await handleFetch(`${baseUrl}/interactions/add?interactionEffect=${encodeURIComponent(interactionEffect)}&drugA=${encodeURIComponent(drugA)}&drugB=${encodeURIComponent(drugB)}`, {
                method: 'POST',
            });
        }

        // Delete Existing Drug Interaction
        async function deleteDrugInteraction() {
            const drugA = document.getElementById('deleteInteractionDrugA').value;
            const drugB = document.getElementById('deleteInteractionDrugB').value;
            const interactionEffect = document.getElementById('deleteInteractionEffect').value;

            if (!drugA || !drugB || !interactionEffect) return alert('Please fill out all required fields.');

            await handleFetch(`${baseUrl}/interactions/delete?interactionEffect=${encodeURIComponent(interactionEffect)}&drugA=${encodeURIComponent(drugA)}&drugB=${encodeURIComponent(drugB)}`, {
                method: 'DELETE',
            });
        }

        // Update Existing Drug Interaction
        async function updateDrugInteraction() {
            const interactionId = document.getElementById('updateInteractionId').value;
            const drugA = document.getElementById('updateInteractionDrugA').value;
            const drugB = document.getElementById('updateInteractionDrugB').value;
            const interactionEffect = document.getElementById('updateInteractionEffect').value;

            if (!interactionId || !drugA || !drugB || !interactionEffect) return alert('Please fill out all required fields.');

            await handleFetch(`${baseUrl}/interactions/update/${encodeURIComponent(interactionId)}?drugA=${encodeURIComponent(drugA)}&drugB=${encodeURIComponent(drugB)}&interactionEffect=${encodeURIComponent(interactionEffect)}`, {
                method: 'PATCH',
            });
        }
    </script>
</body>

</html>